#==========================================================================#
#                          Tablas de Contingencia                          #          
#==========================================================================#

#================================#
#### 1. Directorio de trabajo ####
#================================#
getwd()
setwd("/Users/valentinacardona/Downloads")


#==================================#
#### 2. Instalación de paquetes ####
#==================================#
install.packages('survival')
install.packages('epiR')
library(survival)
library(epiR)


#==================================#
####  3. Importación de datos   ####
#==================================#
```{r}
datos <- read.csv("acuerdo interjueces.csv")
datos
```


#======================================#
####   4. Tablas de contingencia    ####
#======================================#
```{r}
table(datos$juez1, datos$juez2)
```
#CODIFICAR VECTORES COMO FACTORES
```{r}
juez1 <- factor(datos$juez1,
                levels = c(1,0),
                labels = c("Pertinencia", "No pertinencia"))
juez2 <- factor(datos$juez2,
                levels = c(1,0),
                labels = c("Pertinencia", "No pertinencia"))

tabla_contingencia <- table(juez1,juez2); tabla_contingencia
```
#FRECUENCIAS RELATIVAS
```{r}
prop.table(tabla_contingencia) #general
prop.table(tabla_contingencia, margin = 1) #por filas
prop.table(tabla_contingencia, margin = 2) #por columnas
```
#CONVERSIÓN A PORCENTAJE
````{r}
prop.table(tabla_contingencia)*100
````
#AÑADIR TOTALES
````{r}
addmargins(tabla_contingencia) #frecuencias absolutas
addmargins(prop.table(tabla_contingencia)) #frecuencias relativas
````

#======================================#
#### 5. Sensibilidad y Especificidad ####
#======================================#
````{r}
epi.tests(tabla_contingencia, conf.level = 0.95)
````

#======================================#
####    6. Pruebas estadísticas     ####
#======================================#
#Chi-Cuadrado
````{r}
chisq.test(tabla_contingencia)
````
#Prueba exacta de Fisher
````{r}
fisher.test(tabla_contingencia)
````
#Prueba de McNemar
````{r}
mcnemar.test(tabla_contingencia)
````
#Coeficiente de Concordancia (ω) de Kendall
````{r}
cor(x = datos$juez1, y = datos$juez2, method = 'kendall')
````
#Estadístico Kappa
````{r}
kappa(tabla_contingencia)
````

#=================================#
####        7. Gráficos        ####
#=================================#
#MOSAICO
````{r}
mosaicplot(tabla_contingencia,
           main = "Acuerdo interjueces")
````
#GRÁFICO DE BARRAS
````{r}
barplot(tabla_contingencia,
        legend=TRUE,
        beside=TRUE,
        args.legend = list(x = "top"))
````